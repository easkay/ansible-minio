---
- name: restart_rsyslog
  service:
    name: rsyslog
    state: restarted
- name: reload_systemd
  command: "systemctl daemon-reload"
  listen: "reload_systemd"
# Ensure not all minio servers are restarted at once
# https://github.com/ansible/issues/12170
- name: restart_minio_all_instances
  service:
    name: "{{ 'minio' ~ minio_name_separator ~ item[1] }}"
    state: restarted
  run_once: yes
  delegate_to: "{{ item[0] }}"
  with_nested:
    - "{{ play_hosts }}"
    - "{{ minio_instances|map(attribute=name) }}"
- name: restart_minio_specific_instances
  service:
    name: "{{ 'minio' ~ minio_name_separator ~ item[1] }}"
    state: restarted
  run_once: yes
  delegate_to: "{{ item[0] }}"
  with_nested:
    - "{{ play_hosts }}"
    - "{{ minio_instances_to_restart|unique }}"
  listen: "reload_systemd"
- name: reload_sysctl
  command: "/sbin/sysctl -p"
...
